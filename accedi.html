<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accesso - Toelettatura Zampa Felice</title>
    <!-- Favicon removed as per instruction -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Lexend%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
        .form-container {
            max-width: 400px;
            margin: 0 auto;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background-color: #0b80ee;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100" style='font-family: Lexend, "Noto Sans", sans-serif;'>
    <div class="relative flex size-full min-h-screen flex-col justify-center items-center p-4">
        <div class="w-full max-w-md bg-white p-8 rounded-lg shadow-md">
            <div class="text-center mb-6">
                <!-- Removed back arrow, updated title -->
                <h2 class="text-[#111518] text-xl font-bold leading-tight tracking-[-0.015em]">Pet Grooming Service</h2>
                <h1 class="text-[#111518] tracking-light text-[28px] font-bold leading-tight pt-5 pb-3">Benvenuto!</h1>
            </div>

            <div class="mb-4 border-b border-gray-200">
                <nav class="flex -mb-px">
                    <button id="loginTabButton" class="tab-button active text-center w-1/2 py-4 px-1 border-b-2 border-transparent font-medium text-sm hover:border-gray-300 focus:outline-none">
                        Accedi
                    </button>
                    <button id="registerTabButton" class="tab-button text-center w-1/2 py-4 px-1 border-b-2 border-transparent font-medium text-sm hover:border-gray-300 focus:outline-none">
                        Registrati
                    </button>
                </nav>
            </div>

            <!-- Login Form -->
            <div id="loginFormContainer" class="tab-content active">
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="loginEmail" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="loginEmail" name="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#0b80ee] focus:border-[#0b80ee] sm:text-sm">
                    </div>
                    <div>
                        <label for="loginPassword" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="loginPassword" name="password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#0b80ee] focus:border-[#0b80ee] sm:text-sm">
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#0b80ee] hover:bg-[#0a73d6] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#0b80ee]">
                            Accedi
                        </button>
                    </div>
                </form>
                <p id="loginError" class="mt-3 text-center text-sm text-red-600"></p>
            </div>

            <!-- Registration Form -->
            <div id="registerFormContainer" class="tab-content">
                <form id="registerForm" class="space-y-6">
                    <div>
                        <label for="registerFullName" class="block text-sm font-medium text-gray-700">Nome Completo</label>
                        <input type="text" id="registerFullName" name="full_name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#0b80ee] focus:border-[#0b80ee] sm:text-sm">
                    </div>
                    <div>
                        <label for="registerEmail" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="registerEmail" name="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#0b80ee] focus:border-[#0b80ee] sm:text-sm">
                    </div>
                    <div>
                        <label for="registerPassword" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="registerPassword" name="password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#0b80ee] focus:border-[#0b80ee] sm:text-sm">
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#0b80ee] hover:bg-[#0a73d6] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#0b80ee]">
                            Registrati
                        </button>
                    </div>
                </form>
                <p id="registerError" class="mt-3 text-center text-sm text-red-600"></p>
                <p id="registerSuccess" class="mt-3 text-center text-sm text-green-600"></p>
            </div>
        </div>
    </div>

    <script>
        const loginTabButton = document.getElementById('loginTabButton');
        const registerTabButton = document.getElementById('registerTabButton');
        const loginFormContainer = document.getElementById('loginFormContainer');
        const registerFormContainer = document.getElementById('registerFormContainer');

        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');

        const loginError = document.getElementById('loginError');
        const registerError = document.getElementById('registerError');
        const registerSuccess = document.getElementById('registerSuccess');

        loginTabButton.addEventListener('click', () => {
            loginTabButton.classList.add('active');
            registerTabButton.classList.remove('active');
            loginFormContainer.classList.add('active');
            registerFormContainer.classList.remove('active');
            loginError.textContent = '';
            registerError.textContent = '';
            registerSuccess.textContent = '';
        });

        registerTabButton.addEventListener('click', () => {
            registerTabButton.classList.add('active');
            loginTabButton.classList.remove('active');
            registerFormContainer.classList.add('active');
            loginFormContainer.classList.remove('active');
            loginError.textContent = '';
            registerError.textContent = '';
            registerSuccess.textContent = '';
        });

        loginForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            loginError.textContent = '';
            const email = loginForm.email.value;
            const password = loginForm.password.value;
            const loginButton = loginForm.querySelector('button[type="submit"]');

            loginButton.disabled = true;
            loginButton.classList.add('opacity-50', 'cursor-not-allowed');
            const originalButtonText = loginButton.innerHTML; // Assuming it's just text or simple HTML
            loginButton.innerHTML = '<span class="truncate">Accesso in corso...</span>';

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password }),
                });
                const data = await response.json();
                if (response.ok) {
                    // Redirect to home.html or profile.html
                    window.location.href = 'home.html'; // Or profilo.html if preferred
                } else {
                    loginError.textContent = data.error || 'Login failed.';
                }
            } catch (error) {
                loginError.textContent = 'An error occurred. Please try again.';
                console.error('Login error:', error);
            } finally {
                loginButton.disabled = false;
                loginButton.classList.remove('opacity-50', 'cursor-not-allowed');
                loginButton.innerHTML = originalButtonText;
            }
        });

        registerForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            registerError.textContent = '';
            registerSuccess.textContent = '';

            const fullName = registerForm.full_name.value;
            const email = registerForm.email.value;
            const password = registerForm.password.value;
            const registerButton = registerForm.querySelector('button[type="submit"]');

            registerButton.disabled = true;
            registerButton.classList.add('opacity-50', 'cursor-not-allowed');
            const originalButtonText = registerButton.innerHTML;
            registerButton.innerHTML = '<span class="truncate">Registrazione in corso...</span>';

            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ full_name: fullName, email, password }),
                });
                const data = await response.json();
                if (response.status === 201) {
                    registerSuccess.textContent = data.message || 'Registration successful! Please login.';
                    registerForm.reset();
                    // Optionally switch to login tab
                    loginTabButton.click();
                } else {
                    registerError.textContent = data.error || 'Registration failed.';
                }
            } catch (error) {
                registerError.textContent = 'An error occurred. Please try again.';
                console.error('Registration error:', error);
            } finally {
                registerButton.disabled = false;
                registerButton.classList.remove('opacity-50', 'cursor-not-allowed');
                registerButton.innerHTML = originalButtonText;
            }
        });
    </script>
</body>
</html>
